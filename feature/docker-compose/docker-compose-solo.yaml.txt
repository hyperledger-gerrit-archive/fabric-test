version: '2'

services:

    orderer0:
        container_name: orderer0
        image: hyperledger/fabric-orderer
        environment:
            - CONFIGTX_ORDERER_ORDERERTYPE=solo
            - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
            - ORDERER_GENERAL_LISTENPORT=7050
            - ORDERER_GENERAL_LOGLEVEL=debug
            - ORDERER_GENERAL_LEDGERTYPE=ram
            - ORDERER_GENERAL_GENESISMETHOD=file
            - ORDERER_GENERAL_GENESISFILE=orderer.block
            - ORDERER_GENERAL_QUEUESIZE=1000
            - ORDERER_GENERAL_MAXWINDOWSIZE=1000
            - ORDERER_RAMLEDGER_HISTORY_SIZE=100
            - ORDERER_GENERAL_BATCHSIZE=10
            - ORDERER_GENERAL_BATCHTIMEOUT=10s
            - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/configs/msp
            - ORDERER_GENERAL_LOCALMSPID=${ORDERER0_ORDERER_GENERAL_LOCALMSPID}
            - ORDERER_GENERAL_TLS_ENABLED=false
        volumes:
            - ../configs:/var/hyperledger/configs
        working_dir: /opt/gopath/src/github.com/hyperledger/fabric/orderer
        command: orderer
        ports:
          - '7050'

    peer0:
        image: hyperledger/fabric-peer
        environment:
            - CORE_PEER_ID=vp0
            - CORE_PEER_GOSSIP_BOOTSTRAP=peer1:7051
            - CORE_PEER_PROFILE_ENABLED=true
            - CORE_PEER_COMMITTER_LEDGER_ORDERER=orderer0:7050
            - CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs
            - CORE_PEER_LOCALMSPID=${PEER0_CORE_PEER_LOCALMSPID}
            - CORE_NEXT=true
            - CORE_PEER_ENDORSER_ENABLED=true
            - CORE_PEER_GOSSIP_ORGLEADER=false
            - CORE_PEER_GOSSIP_USELEADERELECTION=true
            - CORE_PEER_ADDRESSAUTODETECT=true
            - CORE_LOGGING_LEVEL=DEBUG
            - CORE_PEER_NETWORKID=${CORE_PEER_NETWORKID}
            - CORE_PEER_TLS_ENABLED=false
            - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true
        volumes:
            - ./configs:/var/hyperledger/configs
            - /var/run/docker.sock:/var/run/docker.sock
        ports:
            - '7051'
            - '7053'
        depends_on:
            - orderer0
        command: peer node start --peer-defaultchain=false

    peer1:
        image: hyperledger/fabric-peer
        environment:
            - CORE_PEER_ID=vp1
            - CORE_PEER_GOSSIP_BOOTSTRAP=peer0:7051
            - CORE_PEER_COMMITTER_LEDGER_ORDERER=orderer0:7050
            - CORE_PEER_MSPCONFIGPATH=${PEER1_CORE_PEER_MSPCFGPATH}
            - CORE_PEER_LOCALMSPID=${PEER1_CORE_PEER_LOCALMSPID}
            - CORE_NEXT=true
            - CORE_PEER_ENDORSER_ENABLED=true
            - CORE_PEER_GOSSIP_ORGLEADER=false
            - CORE_PEER_GOSSIP_USELEADERELECTION=true
            - CORE_PEER_ADDRESSAUTODETECT=true
            - CORE_LOGGING_LEVEL=DEBUG
            - CORE_PEER_NETWORKID=${CORE_PEER_NETWORKID}
            - CORE_PEER_TLS_ENABLED=false
            - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true
        volumes:
            - ./configs:/var/hyperledger/configs
            - /var/run/docker.sock:/var/run/docker.sock
        ports:
            - '7051'
            - '7053'
        depends_on:
            - orderer0
            - peer0
        command: peer node start --peer-defaultchain=false

    peer2:
        image: hyperledger/fabric-peer
        environment:
            - CORE_PEER_ID=vp2
            - CORE_PEER_GOSSIP_BOOTSTRAP=peer3:7051
            - CORE_PEER_COMMITTER_LEDGER_ORDERER=orderer0:7050
            - CORE_PEER_MSPCONFIGPATH=${PEER2_CORE_PEER_MSPCFGPATH}
            - CORE_PEER_LOCALMSPID=${PEER2_CORE_PEER_LOCALMSPID}
            - CORE_NEXT=true
            - CORE_PEER_ENDORSER_ENABLED=true
            - CORE_PEER_GOSSIP_ORGLEADER=false
            - CORE_PEER_GOSSIP_USELEADERELECTION=true
            - CORE_PEER_ADDRESSAUTODETECT=true
            - CORE_LOGGING_LEVEL=DEBUG
            - CORE_PEER_NETWORKID=${CORE_PEER_NETWORKID}
            - CORE_PEER_TLS_ENABLED=false
            - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true
        volumes:
            - ./configs:/var/hyperledger/configs
            - /var/run/docker.sock:/var/run/docker.sock
        ports:
            - '7051'
            - '7053'
        depends_on:
            - orderer0
            - peer0
        command: peer node start --peer-defaultchain=false

    peer3:
        image: hyperledger/fabric-peer
        environment:
            - CORE_PEER_ID=vp3
            - CORE_PEER_GOSSIP_BOOTSTRAP=peer2:7051
            - CORE_PEER_COMMITTER_LEDGER_ORDERER=orderer0:7050
            - CORE_PEER_MSPCONFIGPATH=${PEER3_CORE_PEER_MSPCFGPATH}
            - CORE_PEER_LOCALMSPID=${PEER3_CORE_PEER_LOCALMSPID}
            - CORE_NEXT=true
            - CORE_PEER_ENDORSER_ENABLED=true
            - CORE_PEER_GOSSIP_ORGLEADER=false
            - CORE_PEER_GOSSIP_USELEADERELECTION=true
            - CORE_PEER_ADDRESSAUTODETECT=true
            - CORE_LOGGING_LEVEL=DEBUG
            - CORE_PEER_NETWORKID=${CORE_PEER_NETWORKID}
            - CORE_PEER_TLS_ENABLED=false
            - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true
        volumes:
            - ./configs:/var/hyperledger/configs
            - /var/run/docker.sock:/var/run/docker.sock
        ports:
            - '7051'
            - '7053'
        depends_on:
            - orderer0
            - peer0
        command: peer node start --peer-defaultchain=false
